# EPUB è·¨å¹³å°å¤„ç†å·¥å…· â€” v3 æŠ€æœ¯æ–¹æ¡ˆï¼šRust æ ¸å¿ƒæ¶æ„

Rust æ ¸å¿ƒå¼•æ“ + Tauri 2.x æ¡Œé¢/ç§»åŠ¨ç«¯ + React å‰ç«¯ + CLI ç»Ÿä¸€æ¶æ„

> **æœ¬æ–‡æ¡£çŠ¶æ€**ï¼šv3.0 - 2026-03-01 åˆ›å»º
> åŸºäº v2.1 æ–¹æ¡ˆçš„åæ€ï¼šæ—¢ç„¶ GUI å·²é€‰ Tauri (Rust)ï¼Œæ ¸å¿ƒé€»è¾‘ä¸ºä½•ä¸ç”¨ Rust å®ç°ï¼Ÿ

---

## ä¸€ã€ä¸ºä»€ä¹ˆè¦ä» TS è¿ç§»åˆ° Rust æ ¸å¿ƒï¼Ÿ

### 1.1 é—®é¢˜åˆ†æï¼šv2 æ–¹æ¡ˆçš„æ¶æ„çŸ›ç›¾

v2 æ–¹æ¡ˆé€‰æ‹©äº† **Tauri (Rust) ä½œ GUI å£³ + TypeScript ä½œæ ¸å¿ƒé€»è¾‘**ï¼Œè¿™å¯¼è‡´äº†ä¸€ä¸ªå°´å°¬çš„æ¶æ„ï¼š

```text
v2 å½“å‰æ¶æ„é—®é¢˜ï¼š

  Tauri (Rust)                    Node.js (TS)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    sidecar/IPC    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ GUI å£³    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ æ ¸å¿ƒå¤„ç†é€»è¾‘  â”‚
  â”‚ æ–‡ä»¶å¯¹è¯æ¡† â”‚                   â”‚ EPUB è§£æ    â”‚
  â”‚ ç³»ç»Ÿ API  â”‚                   â”‚ å›¾ç‰‡å‹ç¼©     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ åŠ è§£å¯†       â”‚
       â†•                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   React å‰ç«¯                      â†• Python æ¡¥æ¥
                                  encrypt_font.py
```

**æ ¸å¿ƒçŸ›ç›¾**ï¼š
1. **åŒè¿è¡Œæ—¶å¼€é”€**ï¼šTauri å·²åŒ…å« Rustï¼Œè¿˜è¦é¢å¤–æ‰“åŒ… Node.js SEAï¼ˆ~50MB+ï¼‰
2. **IPC æ€§èƒ½ç“¶é¢ˆ**ï¼šRust â†” Node.js è¿›ç¨‹é—´é€šä¿¡å¢åŠ å»¶è¿Ÿå’Œå¤æ‚åº¦
3. **ç§»åŠ¨ç«¯å›°å¢ƒ**ï¼šiOS/Android ä¸Šè¿è¡Œ Node.js sidecar æå…¶å›°éš¾ä¸”ä½“ç§¯å·¨å¤§
4. **åˆ†å‘ä½“ç§¯**ï¼šTauri æœ¬ä½“ ~5MB + Node.js SEA ~50MB = å®é™… 55MB+ï¼ˆè¿œè¶… "10-15MB" é¢„æœŸï¼‰

### 1.2 è§£å†³æ–¹æ¡ˆï¼šRust ç»Ÿä¸€æ ¸å¿ƒ

```text
v3 ç›®æ ‡æ¶æ„ï¼š

  Tauri 2.x (Rust)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚         Rust æ ¸å¿ƒå¼•æ“                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ EPUB   â”‚ å›¾ç‰‡   â”‚ å­—ä½“å¤„ç†      â”‚  â”‚
  â”‚  â”‚ è§£æ   â”‚ è½¬æ¢   â”‚ å­é›†åŒ–+æ··æ·†   â”‚  â”‚
  â”‚  â”‚ æ‰“åŒ…   â”‚ å‹ç¼©   â”‚              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚         Tauri IPC (invoke)           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  React å‰ç«¯ (WebView)         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†•               â†•
      æ¡Œé¢ App         ç§»åŠ¨ App
   (macOS/Win/Linux)   (iOS/Android)
```

### 1.3 TS vs Rust è¯¦ç»†å¯¹æ¯”

| ç»´åº¦ | TypeScript (v2 å½“å‰) | Rust (v3 ææ¡ˆ) | ç»“è®º |
|------|---------------------|---------------|------|
| **è¿è¡Œæ—¶** | Node.js 22+ (~50MB) | æ— é¢å¤–è¿è¡Œæ—¶ (0MB) | âœ… Rust |
| **Tauri é›†æˆ** | éœ€ sidecar + IPC | ç›´æ¥é›†æˆï¼Œé›¶å¼€é”€ | âœ… Rust |
| **ç§»åŠ¨ç«¯** | Node.js æ— æ³•åœ¨ iOS/Android è¿è¡Œ | Tauri 2.x åŸç”Ÿæ”¯æŒ | âœ… Rust |
| **æ€§èƒ½** | V8 JITï¼Œä¸é”™ä½†æœ‰ GC åœé¡¿ | é›¶æˆæœ¬æŠ½è±¡ï¼Œæ—  GC | âœ… Rust |
| **æ‰“åŒ…ä½“ç§¯** | Tauri + Node SEA ~55MB | çº¯ Tauri ~5-8MB | âœ… Rust |
| **EPUB åº“** | jszip, fast-xml-parser (æˆç†Ÿ) | lib-epub, quick-xml, zip (æˆç†Ÿ) | å¹³æ‰‹ |
| **å›¾ç‰‡åº“** | sharp (libvips, å¾ˆå¿«) | image crate + WebP (åŸç”Ÿ) | å¹³æ‰‹ |
| **HTML æ“ä½œ** | cheerio (jQuery-like, æˆç†Ÿ) | scraper + html5ever (æˆç†Ÿ) | å¹³æ‰‹ |
| **CSS æ“ä½œ** | css-tree (æˆç†Ÿ) | lightningcss (æ›´å¿«) | âœ… Rust |
| **å­—ä½“å­é›†åŒ–** | subset-font (JS) | allsorts / font_subset (åŸç”Ÿ) | âœ… Rust |
| **å­—ä½“æ··æ·†** | æ¡¥æ¥ Python fontTools | allsorts å¯åšéƒ¨åˆ†æ“ä½œ | âš ï¸ éœ€è¯„ä¼° |
| **ç®€ç¹è½¬æ¢** | opencc-js (æˆç†Ÿ) | opencc-rust ç»‘å®š | å¹³æ‰‹ |
| **å¼€å‘é€Ÿåº¦** | å¿«ï¼ŒåŸå‹è¿­ä»£å¿« | è¾ƒæ…¢ï¼Œç¼–è¯‘æ—¶é—´é•¿ | âœ… TS |
| **å­¦ä¹ æ›²çº¿** | ä½ | é«˜ï¼ˆæ‰€æœ‰æƒã€ç”Ÿå‘½å‘¨æœŸï¼‰ | âœ… TS |
| **ç”Ÿæ€æˆç†Ÿåº¦** | npm æå…¶ä¸°å¯Œ | crates.io å¿«é€Ÿå¢é•¿ | âœ… TS |
| **CLI å·¥å…·** | commander.js (ç®€å•) | clap (åŠŸèƒ½æ›´å¼º) | âœ… Rust |
| **è·¨å¹³å°ä¸€è‡´æ€§** | å„å¹³å° Node.js è¡Œä¸ºä¸€è‡´ | ç¼–è¯‘ä¸ºåŸç”Ÿï¼Œæ€§èƒ½æœ€ä¼˜ | âœ… Rust |

### 1.4 å…³é”®å†³ç­–å› ç´ 

**é€‰æ‹© Rust æ ¸å¿ƒçš„æ ¹æœ¬åŸå› **ï¼š

1. **ç§»åŠ¨ç«¯æ˜¯åˆšéœ€** â€” ç”¨æˆ·æ˜ç¡®å¸Œæœ›"ç®€å•æ ¸å¿ƒåŠŸèƒ½ä¸‹æ”¾åˆ°ç§»åŠ¨ç«¯"ï¼ŒNode.js åœ¨ iOS/Android ä¸Šä¸å¯è¡Œ
2. **Tauri 2.x å·²åŸç”Ÿæ”¯æŒç§»åŠ¨ç«¯** â€” iOS (WKWebView) + Android (WebView)ï¼ŒRust åç«¯ç›´æ¥å¤ç”¨
3. **æ¶ˆé™¤ sidecar æ¶æ„** â€” ä¸å†éœ€è¦ Node.js SEA æ‰“åŒ…ï¼Œå¤§å¹…é™ä½å¤æ‚åº¦å’Œä½“ç§¯
4. **Rust ç”Ÿæ€å·²è¶³å¤Ÿæˆç†Ÿ** â€” EPUBã€å›¾ç‰‡ã€å­—ä½“ã€HTML/CSS å¤„ç†éƒ½æœ‰å¯é çš„ crate

---

## äºŒã€v3 æ€»ä½“æ¶æ„

### 2.1 æ¶æ„å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·ç•Œé¢å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CLI (clap)    â”‚  â”‚ Desktop GUI  â”‚  â”‚ Mobile App        â”‚  â”‚
â”‚  â”‚ epub-tools    â”‚  â”‚ Tauri 2.x    â”‚  â”‚ Tauri 2.x         â”‚  â”‚
â”‚  â”‚ ç»ˆç«¯ç›´æ¥ä½¿ç”¨   â”‚  â”‚ macOS/Win/   â”‚  â”‚ iOS/Android       â”‚  â”‚
â”‚  â”‚              â”‚  â”‚ Linux        â”‚  â”‚ ç²¾ç®€åŠŸèƒ½å­é›†       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                       â–¼                                      â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚        â”‚  epub-core (Rust lib crate)      â”‚ â† æ ¸å¿ƒåº“         â”‚
â”‚        â”‚  ä¸€æ¬¡ç¼–å†™ï¼Œæ¡Œé¢/ç§»åŠ¨/CLI å…±ç”¨      â”‚                  â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚        â”‚  epub/     EPUB è§£æ/æ‰“åŒ…/é‡æ„    â”‚                  â”‚
â”‚        â”‚  image/    å›¾ç‰‡è½¬æ¢/å‹ç¼©          â”‚                  â”‚
â”‚        â”‚  font/     å­—ä½“å­é›†åŒ–/æ··æ·†        â”‚                  â”‚
â”‚        â”‚  crypto/   æ–‡ä»¶ååŠ å¯†/è§£å¯†        â”‚                  â”‚
â”‚        â”‚  txt/      TXTâ†’EPUB è½¬æ¢         â”‚                  â”‚
â”‚        â”‚  chinese/  ç®€ç¹è½¬æ¢              â”‚                  â”‚
â”‚        â”‚  edit/     ç¼–è¾‘å·¥ä½œæµ             â”‚ â† ä»…æ¡Œé¢/CLI      â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                       â”‚                                      â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚        â–¼              â–¼                  â–¼                   â”‚
â”‚   Rust åŸç”Ÿ crate   ç³»ç»Ÿ API          å¯é€‰å¤–éƒ¨å·¥å…·            â”‚
â”‚   Â· lib-epub        Â· æ–‡ä»¶ç³»ç»Ÿ         Â· jpegoptim            â”‚
â”‚   Â· image           Â· ç½‘ç»œè¯·æ±‚         Â· oxipng               â”‚
â”‚   Â· quick-xml       Â· è¿›ç¨‹ç®¡ç†                               â”‚
â”‚   Â· scraper                                                  â”‚
â”‚   Â· lightningcss                                             â”‚
â”‚   Â· allsorts                                                 â”‚
â”‚   Â· zip                                                      â”‚
â”‚   Â· clap                                                     â”‚
â”‚   Â· opencc-rust                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **Rust åšæ ¸å¿ƒ** â€” EPUB è§£æ/æ‰“åŒ…ã€åŠ è§£å¯†ã€å›¾ç‰‡å¤„ç†ã€æ ¼å¼åŒ–ç­‰å…¨éƒ¨ Rust å®ç°
2. **ä¸€æ¬¡ç¼–å†™ï¼Œå¤šç«¯è¿è¡Œ** â€” `epub-core` æ˜¯çº¯ Rust lib crateï¼Œæ¡Œé¢/ç§»åŠ¨/CLI å…±ç”¨
3. **æ¸è¿›å¼åŠŸèƒ½** â€” ç§»åŠ¨ç«¯åªæä¾›æ ¸å¿ƒå­é›†ï¼ˆæ ¼å¼åŒ–ã€åŠ è§£å¯†ã€å›¾ç‰‡è½¬æ¢ï¼‰
4. **å­—ä½“æ··æ·†ä¿ç•™ Python** â€” `encrypt_font.py` ç»§ç»­ä½¿ç”¨ Python fontToolsï¼Œä»…åœ¨æ¡Œé¢ç«¯å’Œ CLI é€šè¿‡è¿›ç¨‹è°ƒç”¨ï¼ˆä¸å›¾ç‰‡æé™å‹ç¼©å·¥å…· jpegoptim/oxipng ç±»ä¼¼ï¼Œå±äºæ¡Œé¢/CLI ä¸“å±åŠŸèƒ½ï¼‰
5. **CLI ç‹¬ç«‹å¯ç”¨** â€” CLI æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œä¸ä¾èµ– GUI

---

## ä¸‰ã€Rust Crate æŠ€æœ¯æ ˆæ˜ å°„

### 3.1 æ ¸å¿ƒå¤„ç†åº“ (`epub-core`)

| åŠŸèƒ½æ¨¡å— | v2 (TS) æ–¹æ¡ˆ | v3 (Rust) crate | è¯´æ˜ |
|---------|-------------|-----------------|------|
| **ZIP è¯»å†™** | `jszip` | `zip` | Rust åŸç”Ÿ ZIP åº“ï¼Œæ”¯æŒ STORE/DEFLATE |
| **XML è§£æ** | `fast-xml-parser` | `quick-xml` | é›¶æ‹·è´é«˜é€Ÿ XML è§£æ |
| **HTML æ“ä½œ** | `cheerio` | `scraper` + `html5ever` | CSS é€‰æ‹©å™¨ + HTML5 è§£æ |
| **CSS è§£æ** | `css-tree` | `lightningcss` | Mozilla å‡ºå“ï¼Œæ¯” css-tree æ›´å¿« |
| **EPUB è§£æ** | è‡ªå®šä¹‰ `parser.ts` | `lib-epub` æˆ–è‡ªå®šä¹‰ | å¯ç”¨ lib-epubï¼Œä¹Ÿå¯åŸºäº quick-xml è‡ªå†™ |
| **å›¾ç‰‡å¤„ç†** | `sharp` (libvips) | `image` crate | æ”¯æŒ JPEG/PNG/WebP/GIF ç¼–è§£ç  |
| **å­—ä½“å­é›†åŒ–** | `subset-font` (JS) | `allsorts` | æ”¯æŒ OpenType/WOFF/WOFF2 å­é›†åŒ– |
| **å­—ä½“æ··æ·†** | Python `fonttools` | **ä¿ç•™ Python** (`encrypt_font.py`) | æ¡Œé¢/CLI ä¸“å±ï¼Œé€šè¿‡è¿›ç¨‹è°ƒç”¨ Python |
| **åŠ è§£å¯†** | Node `crypto` | `md5` + Rust æ ‡å‡†åº“ | MD5 å“ˆå¸Œ + å­—ç¬¦ä¸²æ“ä½œ |
| **æ¨¡ç³ŠåŒ¹é…** | `string-similarity-js` | `strsim` | ç¼–è¾‘è·ç¦»/ç›¸ä¼¼åº¦è®¡ç®— |
| **ç®€ç¹è½¬æ¢** | `opencc-js` | `opencc-rust` æˆ–å†…åµŒè¯å…¸ | OpenCC Rust ç»‘å®š |
| **Git æ“ä½œ** | `simple-git` | `git2` (libgit2) | åŸç”Ÿ Git æ“ä½œï¼Œæ— éœ€ç³»ç»Ÿ git |
| **æ–‡ä»¶ç›‘å¬** | `chokidar` | `notify` | è·¨å¹³å°æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ç›‘å¬ |
| **HTTP è¯·æ±‚** | `axios` | `reqwest` | async HTTP å®¢æˆ·ç«¯ |
| **æ—¥å¿—** | `consola` | `tracing` + `tracing-subscriber` | ç»“æ„åŒ–æ—¥å¿—ï¼Œæ”¯æŒå¤šè¾“å‡º |
| **CLI æ¡†æ¶** | `commander.js` | `clap` | å£°æ˜å¼ CLIï¼Œè‡ªåŠ¨ç”Ÿæˆå¸®åŠ© |
| **åºåˆ—åŒ–** | JSON.parse/stringify | `serde` + `serde_json` | é›¶æˆæœ¬åºåˆ—åŒ–/ååºåˆ—åŒ– |
| **å¼‚æ­¥è¿è¡Œæ—¶** | Node.js event loop | `tokio` | é«˜æ€§èƒ½å¼‚æ­¥è¿è¡Œæ—¶ |

### 3.2 GUI å±‚

| ç»„ä»¶ | v2 æ–¹æ¡ˆ | v3 æ–¹æ¡ˆ | å˜åŒ– |
|------|--------|--------|------|
| **GUI æ¡†æ¶** | Tauri 2.x | Tauri 2.x | **ä¸å˜** |
| **å‰ç«¯æ¡†æ¶** | React 18 + shadcn/ui | React 18 + shadcn/ui | **ä¸å˜** |
| **æ ·å¼** | TailwindCSS | TailwindCSS | **ä¸å˜** |
| **åç«¯è°ƒç”¨** | Tauri â†’ Node.js sidecar | Tauri â†’ ç›´æ¥ Rust å‡½æ•° | âœ… **ç®€åŒ–** |
| **è¿›åº¦å›è°ƒ** | WebSocket / IPC | Tauri event system | âœ… **ç®€åŒ–** |

### 3.3 æµ‹è¯•

| å·¥å…· | v2 (TS) | v3 (Rust) | è¯´æ˜ |
|------|--------|-----------|------|
| **å•å…ƒæµ‹è¯•** | vitest | `#[cfg(test)]` + cargo test | Rust å†…ç½®æµ‹è¯•æ¡†æ¶ |
| **å±æ€§æµ‹è¯•** | fast-check | `proptest` / `quickcheck` | Rust å±æ€§æµ‹è¯• crate |
| **é›†æˆæµ‹è¯•** | vitest | `tests/` ç›®å½• | cargo test è‡ªåŠ¨å‘ç° |
| **åŸºå‡†æµ‹è¯•** | æ—  | `criterion` | æ€§èƒ½å›å½’æµ‹è¯• |

---

## å››ã€é¡¹ç›®ç»“æ„ (v3)

```text
epub-tools/
â”œâ”€â”€ Cargo.toml                     # Workspace root
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ rust-toolchain.toml            # Rust ç‰ˆæœ¬é”å®š
â”œâ”€â”€ .mise.toml                     # å¼€å‘å·¥å…·ç‰ˆæœ¬ç®¡ç†
â”‚
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ epub-core/                 # ğŸ”§ æ ¸å¿ƒå¤„ç†åº“ï¼ˆçº¯ Rust lib crateï¼‰
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs             # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚       â”œâ”€â”€ epub/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ parser.rs      # EPUB è§£æ (quick-xml + zip)
â”‚   â”‚       â”‚   â”œâ”€â”€ writer.rs      # EPUB æ‰“åŒ… (mimetype STORE)
â”‚   â”‚       â”‚   â”œâ”€â”€ reformat.rs    # æ ¼å¼è§„èŒƒåŒ– (Sigil æ ‡å‡†ç»“æ„)
â”‚   â”‚       â”‚   â””â”€â”€ upgrade.rs     # EPUB2 â†’ EPUB3 å‡çº§
â”‚   â”‚       â”œâ”€â”€ image/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ webp_converter.rs  # WebP â†” JPG/PNG
â”‚   â”‚       â”‚   â”œâ”€â”€ compressor.rs      # å›¾ç‰‡å‹ç¼©
â”‚   â”‚       â”‚   â””â”€â”€ download_remote.rs # ä¸‹è½½è¿œç¨‹å›¾ç‰‡
â”‚   â”‚       â”œâ”€â”€ font/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ subsetter.rs   # å­—ä½“å­é›†åŒ– (allsorts)
â”‚   â”‚       â”‚   â””â”€â”€ obfuscator.rs  # å­—ä½“æ··æ·† (è°ƒç”¨ Python encrypt_font.pyï¼Œæ¡Œé¢/CLI ä¸“å±)
â”‚   â”‚       â”œâ”€â”€ crypto/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ encrypt.rs     # æ–‡ä»¶ååŠ å¯†
â”‚   â”‚       â”‚   â””â”€â”€ decrypt.rs     # æ–‡ä»¶åè§£å¯†
â”‚   â”‚       â”œâ”€â”€ txt/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ parser.rs      # TXT è§£æ
â”‚   â”‚       â”‚   â”œâ”€â”€ chapter_splitter.rs  # ç« èŠ‚åˆ†å‰²
â”‚   â”‚       â”‚   â””â”€â”€ epub_creator.rs     # ç”Ÿæˆ EPUB
â”‚   â”‚       â”œâ”€â”€ chinese/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â””â”€â”€ converter.rs   # ç®€ç¹è½¬æ¢
â”‚   â”‚       â”œâ”€â”€ edit/              # ä»…æ¡Œé¢/CLI
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ workspace.rs   # Git å·¥ä½œåŒº
â”‚   â”‚       â”‚   â”œâ”€â”€ watcher.rs     # æ–‡ä»¶ç›‘å¬
â”‚   â”‚       â”‚   â””â”€â”€ packer.rs      # æ‰“åŒ…
â”‚   â”‚       â””â”€â”€ utils/
â”‚   â”‚           â”œâ”€â”€ mod.rs
â”‚   â”‚           â”œâ”€â”€ logger.rs      # æ—¥å¿— (tracing)
â”‚   â”‚           â”œâ”€â”€ config.rs      # é…ç½®ç®¡ç†
â”‚   â”‚           â””â”€â”€ tool_checker.rs # å·¥å…·æ£€æµ‹
â”‚   â”‚
â”‚   â””â”€â”€ epub-cli/                  # ğŸ–¥ï¸ CLI å…¥å£
â”‚       â”œâ”€â”€ Cargo.toml
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ main.rs
â”‚           â””â”€â”€ commands/
â”‚               â”œâ”€â”€ mod.rs
â”‚               â”œâ”€â”€ process.rs     # ä¸€é”®å¤„ç†
â”‚               â”œâ”€â”€ reformat.rs    # æ ¼å¼åŒ–
â”‚               â”œâ”€â”€ encrypt.rs     # åŠ å¯†
â”‚               â”œâ”€â”€ decrypt.rs     # è§£å¯†
â”‚               â”œâ”€â”€ convert_webp.rs # WebP è½¬æ¢
â”‚               â”œâ”€â”€ compress.rs    # å›¾ç‰‡å‹ç¼©
â”‚               â”œâ”€â”€ subset_fonts.rs # å­—ä½“å­é›†åŒ–
â”‚               â”œâ”€â”€ obfuscate_font.rs # å­—ä½“æ··æ·†
â”‚               â”œâ”€â”€ txt_to_epub.rs # TXT è½¬ EPUB
â”‚               â”œâ”€â”€ chinese_convert.rs # ç®€ç¹è½¬æ¢
â”‚               â”œâ”€â”€ download_images.rs # ä¸‹è½½è¿œç¨‹å›¾ç‰‡
â”‚               â”œâ”€â”€ edit.rs        # ç¼–è¾‘å·¥ä½œæµ
â”‚               â””â”€â”€ doctor.rs      # ç¯å¢ƒæ£€æµ‹
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ gui/                       # ğŸ–¼ï¸ Tauri æ¡Œé¢åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ package.json           # React å‰ç«¯ä¾èµ–
â”‚   â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”‚   â”œâ”€â”€ src/                   # React å‰ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ActionBar.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LogPanel.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressBar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SettingsDialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”‚   â”‚       â””â”€â”€ tauri-bridge.ts # Tauri IPC è°ƒç”¨å°è£…
â”‚   â”‚   â””â”€â”€ src-tauri/             # Rust åç«¯
â”‚   â”‚       â”œâ”€â”€ Cargo.toml         # ä¾èµ– epub-core
â”‚   â”‚       â”œâ”€â”€ tauri.conf.json
â”‚   â”‚       â””â”€â”€ src/
â”‚   â”‚           â”œâ”€â”€ main.rs
â”‚   â”‚           â”œâ”€â”€ lib.rs
â”‚   â”‚           â””â”€â”€ commands.rs    # ç›´æ¥è°ƒç”¨ epub-core
â”‚   â”‚
â”‚   â””â”€â”€ mobile/                    # ğŸ“± Tauri ç§»åŠ¨ç«¯åº”ç”¨
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ vite.config.ts
â”‚       â”œâ”€â”€ src/                   # React å‰ç«¯ï¼ˆç²¾ç®€ç‰ˆï¼‰
â”‚       â”‚   â”œâ”€â”€ App.tsx
â”‚       â”‚   â””â”€â”€ components/
â”‚       â”‚       â”œâ”€â”€ FileList.tsx
â”‚       â”‚       â”œâ”€â”€ QuickActions.tsx  # ç§»åŠ¨ç«¯å¿«æ·æ“ä½œ
â”‚       â”‚       â””â”€â”€ ResultView.tsx
â”‚       â””â”€â”€ src-tauri/             # Rust åç«¯
â”‚           â”œâ”€â”€ Cargo.toml         # ä¾èµ– epub-core (features = ["mobile"])
â”‚           â”œâ”€â”€ tauri.conf.json
â”‚           â””â”€â”€ src/
â”‚               â”œâ”€â”€ lib.rs         # Tauri mobile entry
â”‚               â””â”€â”€ commands.rs    # ç§»åŠ¨ç«¯å‘½ä»¤å­é›†
â”‚
â”œâ”€â”€ py-scripts/                    # Python (å­—ä½“æ··æ·†ï¼Œæ¡Œé¢/CLI ä¸“å±)
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ encrypt_font.py            # å­—ä½“æ··æ·†ï¼ˆé€šè¿‡è¿›ç¨‹è°ƒç”¨ï¼‰
â”‚
â”œâ”€â”€ skills/                        # å¯å¤ç”¨ç‹¬ç«‹è„šæœ¬
â”‚   â”œâ”€â”€ README.md
â”‚   â””â”€â”€ rs/                        # Rust skills (æ›¿ä»£ ts/)
â”‚       â”œâ”€â”€ epub-info.rs
â”‚       â”œâ”€â”€ charset-scan.rs
â”‚       â”œâ”€â”€ find-broken-links.rs
â”‚       â”œâ”€â”€ regex-annotate.rs
â”‚       â”œâ”€â”€ merge-epub.rs
â”‚       â””â”€â”€ split-epub.rs
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ plan-epubToolsV2.prompt.md
â”‚   â”œâ”€â”€ plan-epubToolsV2-updated.md
â”‚   â”œâ”€â”€ plan-epubToolsV3-rust-core.md    # â­ æœ¬æ–‡æ¡£
â”‚   â””â”€â”€ comparison-with-wangyyyqw-epub.md
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ fixtures/                   # æµ‹è¯•ç”¨ EPUB æ–‡ä»¶
    â””â”€â”€ integration/                # é›†æˆæµ‹è¯•
```

---

## äº”ã€åŠŸèƒ½ä¸å¹³å°çŸ©é˜µ

### 5.1 åŠŸèƒ½åˆ†çº§

| åŠŸèƒ½ | æ¡Œé¢ (Desktop) | CLI | ç§»åŠ¨ç«¯ (Mobile) | ä¼˜å…ˆçº§ |
|------|:---:|:---:|:---:|:---:|
| EPUB æ ¼å¼åŒ– (reformat) | âœ… | âœ… | âœ… | P0 |
| æ–‡ä»¶ååŠ å¯† (encrypt) | âœ… | âœ… | âœ… | P0 |
| æ–‡ä»¶åè§£å¯† (decrypt) | âœ… | âœ… | âœ… | P0 |
| WebP å›¾ç‰‡è½¬æ¢ | âœ… | âœ… | âœ… | P0 |
| å›¾ç‰‡å‹ç¼© | âœ… | âœ… | âœ… | P0 |
| EPUB2â†’3 å‡çº§ | âœ… | âœ… | âœ… | P1 |
| TXT â†’ EPUB | âœ… | âœ… | âœ… | P1 |
| ç®€ç¹è½¬æ¢ | âœ… | âœ… | âœ… | P1 |
| å­—ä½“å­é›†åŒ– | âœ… | âœ… | âŒ | P1 |
| å­—ä½“æ··æ·† | âœ… | âœ… | âŒ | P2 |
| ä¸‹è½½è¿œç¨‹å›¾ç‰‡ | âœ… | âœ… | âŒ | P2 |
| ç¼–è¾‘å·¥ä½œæµ (Git) | âœ… | âœ… | âŒ | P2 |
| EPUB åˆå¹¶/æ‹†åˆ† | âœ… | âœ… | âŒ | P2 |
| æ­£åˆ™æ³¨é‡Š/è„šæ³¨ | âœ… | âœ… | âŒ | P3 |

### 5.2 ç§»åŠ¨ç«¯åŠŸèƒ½å­é›†è¯´æ˜

ç§»åŠ¨ç«¯ä»…æä¾› **P0 + P1 æ ¸å¿ƒåŠŸèƒ½**ï¼Œç†ç”±ï¼š
- ç§»åŠ¨ç«¯å­˜å‚¨/å†…å­˜æœ‰é™ï¼Œæ’é™¤å¤§æ–‡ä»¶æ“ä½œï¼ˆå­—ä½“ã€Gitï¼‰
- ç§»åŠ¨ç«¯æ“ä½œç®€æ´åŒ–ï¼Œæ’é™¤å¤æ‚ç¼–è¾‘æµç¨‹
- ç®€ç¹è½¬æ¢å’Œ TXTâ†’EPUB æ˜¯ä¸­æ–‡ç”¨æˆ·é«˜é¢‘éœ€æ±‚ï¼Œä¿ç•™

---

## å…­ã€å­—ä½“æ··æ·†æ–¹æ¡ˆï¼ˆä¿ç•™ Pythonï¼‰

### 6.1 å†³ç­–ï¼šå­—ä½“æ··æ·†ä¿ç•™ Python å®ç°

`encrypt_font.py` ä½¿ç”¨ Python fontTools åº“è¿›è¡Œå¤æ‚çš„å­—ä½“æ“ä½œï¼ˆCMap æ“ä½œã€Glyph å¤åˆ¶ã€
å­—ä½“æ„å»ºï¼‰ï¼Œè¿™äº›æ“ä½œåœ¨ Rust ç”Ÿæ€ä¸­å°šæ— å®Œå…¨ç­‰ä»·çš„æˆç†Ÿæ–¹æ¡ˆã€‚

**å†³ç­–**ï¼šå­—ä½“æ··æ·†**ä¿ç•™ Python å®ç°**ï¼Œä¸å›¾ç‰‡æé™å‹ç¼©å·¥å…·ï¼ˆjpegoptim/oxipngï¼‰ä¸€æ ·ï¼Œ
å±äº**æ¡Œé¢ç«¯å’Œ CLI ä¸“å±åŠŸèƒ½**ï¼Œé€šè¿‡è¿›ç¨‹è°ƒç”¨ Python è„šæœ¬å®Œæˆã€‚

### 6.2 è°ƒç”¨æ–¹å¼

```rust
// crates/epub-core/src/font/obfuscator.rs
// æ¡Œé¢ç«¯/CLI: é€šè¿‡ std::process::Command è°ƒç”¨ Python
pub fn obfuscate_font(epub_path: &str, output_path: &str) -> Result<()> {
    let status = std::process::Command::new("python3")
        .args(&["py-scripts/encrypt_font.py", epub_path, "-o", output_path])
        .status()?;
    // ...
}
```

### 6.3 å¹³å°å¯ç”¨æ€§

| åŠŸèƒ½ | æ¡Œé¢ (Desktop) | CLI | ç§»åŠ¨ç«¯ (Mobile) | ä¾èµ– |
|------|:---:|:---:|:---:|------|
| å­—ä½“æ··æ·† | âœ… | âœ… | âŒ | Python 3.9+ + fontTools |
| å›¾ç‰‡æé™å‹ç¼© | âœ… | âœ… | âŒ | jpegoptim / oxipng |
| å­—ä½“å­é›†åŒ– | âœ… | âœ… | âŒ | Rust allsorts (å†…ç½®) |

> è¿™äº›åŠŸèƒ½åœ¨ç§»åŠ¨ç«¯ä¸å¯ç”¨ï¼Œå› ä¸ºç§»åŠ¨ç«¯æ— æ³•è¿è¡Œ Python æˆ–ç³»ç»Ÿå‘½ä»¤è¡Œå·¥å…·ã€‚

---

## ä¸ƒã€CLI è®¾è®¡ (v3)

```bash
# === ç¼–è¯‘å®‰è£… ===
cargo install epub-tools      # ä» crates.io å®‰è£…
# æˆ–
cargo build --release         # æœ¬åœ°æ„å»º
# è¾“å‡º: target/release/epub-tools (å•äºŒè¿›åˆ¶ï¼Œçº¦ 5-10MB)

# === ä¸€é”®å¤„ç† ===
epub-tools process book.epub -o output/ --convert-webp --compress --subset-fonts

# === å•é¡¹åŠŸèƒ½ ===
epub-tools reformat book.epub -o output/
epub-tools encrypt book.epub -o output/
epub-tools decrypt book.epub -o output/
epub-tools convert-webp book.epub -o output/
epub-tools compress book.epub -o output/ --level balanced
epub-tools subset-fonts book.epub -o output/
epub-tools obfuscate-font book.epub -o output/
epub-tools upgrade book.epub -o output/ --target 3.3

# === æ–°å¢åŠŸèƒ½ ===
epub-tools txt-to-epub book.txt -o book.epub
epub-tools chinese-convert book.epub -o output/ --to traditional
epub-tools download-images book.epub -o output/

# === ç¼–è¾‘å·¥ä½œæµ ===
epub-tools edit book.epub
epub-tools watch ~/.epub-workspace/book/
epub-tools pack ~/.epub-workspace/book/ -o out.epub

# === å·¥å…· ===
epub-tools doctor                  # ç¯å¢ƒæ£€æµ‹
epub-tools info book.epub          # EPUB ä¿¡æ¯
epub-tools merge a.epub b.epub -o merged.epub
epub-tools split book.epub -o output/

# === Shell è¡¥å…¨ ===
epub-tools completions bash > ~/.bash_completion.d/epub-tools
epub-tools completions zsh > ~/.zfunc/_epub-tools
epub-tools completions fish > ~/.config/fish/completions/epub-tools.fish
```

**CLI ä¼˜åŠ¿ï¼ˆå¯¹æ¯” v2 TS CLIï¼‰**ï¼š
- **å•äºŒè¿›åˆ¶**ï¼š`cargo install` æˆ–ç›´æ¥ä¸‹è½½ï¼Œæ— éœ€ Node.js/pnpm
- **å¯åŠ¨é€Ÿåº¦**ï¼š~1msï¼ˆRustï¼‰vs ~200msï¼ˆNode.jsï¼‰
- **Shell è¡¥å…¨**ï¼šclap è‡ªåŠ¨ç”Ÿæˆ
- **äº¤å‰ç¼–è¯‘**ï¼š`cross` å·¥å…·ä¸€é”®ç¼–è¯‘æ‰€æœ‰å¹³å°

---

## å…«ã€GUI å¸ƒå±€ (v3)

### 8.1 æ¡Œé¢ç«¯

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EPUB Tools v3                                 [è®¾ç½®] [ä¸»é¢˜] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                                  â”‚
â”‚  ä¾§è¾¹æ    â”‚  ğŸ“‚ å¾…å¤„ç†æ–‡ä»¶                                    â”‚
â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ [æ·»åŠ æ–‡ä»¶] â”‚  â”‚  #  æ–‡ä»¶å           è·¯å¾„              çŠ¶æ€  â”‚    â”‚
â”‚ [æ·»åŠ æ–‡ä»¶å¤¹]â”‚  â”‚  1  book1.epub      /Users/.../book1  å¾…å¤„ç†â”‚    â”‚
â”‚ [æ¸…ç©ºåˆ—è¡¨] â”‚  â”‚  2  novel.txt       /Users/.../novel   å¾…å¤„ç†â”‚    â”‚
â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                                                  â”‚
â”‚          â”‚  ğŸ“ è¾“å‡ºè·¯å¾„: [é»˜è®¤: æºæ–‡ä»¶åŒçº§ç›®å½•] [é€‰æ‹©] [é‡ç½®]   â”‚
â”‚ ä½¿ç”¨è¯´æ˜  â”‚                                                  â”‚
â”‚ Â· æ‹–æ‹½æ·»åŠ â”‚  ğŸ”§ æ“ä½œ                                          â”‚
â”‚ Â· å³é”®èœå•â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åŸºç¡€åŠŸèƒ½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ Â· TXTæ–‡ä»¶ â”‚  â”‚[æ ¼å¼åŒ–] [è§£å¯†] [åŠ å¯†] [å­—ä½“æ··æ·†]            â”‚  â”‚
â”‚          â”‚  â”‚[å›¾ç‰‡è½¬æ¢] [å›¾ç‰‡å‹ç¼©â–¾] [å­—ä½“å­é›†åŒ–] [å‡çº§]    â”‚  â”‚
â”‚ GitHub â†— â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ‰©å±•åŠŸèƒ½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ âš¡ Rust   â”‚  â”‚[TXTâ†’EPUB] [ç®€ç¹è½¬æ¢] [ä¸‹è½½è¿œç¨‹å›¾ç‰‡]        â”‚  â”‚
â”‚   æ ¸å¿ƒ    â”‚  â”‚[EPUBåˆå¹¶] [EPUBæ‹†åˆ†] [æ­£åˆ™æ³¨é‡Š]            â”‚  â”‚
â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚          â”‚                                                  â”‚
â”‚          â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  75%  å¤„ç†ä¸­...          â”‚
â”‚          â”‚                                                  â”‚
â”‚          â”‚  ğŸ“‹ æ‰§è¡Œæ—¥å¿—                                       â”‚
â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚          â”‚  â”‚ âœ… book1.epub  æ ¼å¼åŒ–æˆåŠŸ (12ms)           â”‚    â”‚
â”‚          â”‚  â”‚ âœ… novel.txt   è½¬æ¢ä¸º EPUB æˆåŠŸ (8ms)      â”‚    â”‚
â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ç§»åŠ¨ç«¯ï¼ˆç²¾ç®€ç‰ˆï¼‰

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EPUB Tools              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                          â”‚
â”‚  ğŸ“‚ é€‰æ‹©æ–‡ä»¶              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ book.epub    âœ…   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚
â”‚  âš¡ å¿«æ·æ“ä½œ              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ ¼å¼åŒ–  â”‚â”‚ è§£å¯†   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŠ å¯†   â”‚â”‚å›¾ç‰‡è½¬æ¢ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å‹ç¼©   â”‚â”‚ç®€ç¹è½¬æ¢ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   TXT â†’ EPUB     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚
â”‚  ğŸ“‹ ç»“æœ                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… å¤„ç†æˆåŠŸ        â”‚   â”‚
â”‚  â”‚ è¾“å‡º: book_r.epub â”‚   â”‚
â”‚  â”‚ [åˆ†äº«] [æ‰“å¼€]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€Tauri 2.x åç«¯å®ç°ç¤ºä¾‹

### 9.1 æ¡Œé¢ç«¯ Tauri Commandï¼ˆç›´æ¥è°ƒç”¨ Rust æ ¸å¿ƒï¼‰

```rust
// packages/gui/src-tauri/src/commands.rs
use epub_core::{epub, image, crypto, txt, chinese};
use serde::{Deserialize, Serialize};
use tauri::Emitter; // ç”¨äºè¿›åº¦äº‹ä»¶

#[derive(Debug, Serialize, Deserialize)]
pub struct ProcessResult {
    pub success: bool,
    pub message: String,
    pub output_path: Option<String>,
    pub elapsed_ms: u64,
}

/// æ ¼å¼åŒ– EPUB
#[tauri::command]
pub async fn reformat_epub(
    file_path: String,
    output_path: String,
    app: tauri::AppHandle,
) -> Result<ProcessResult, String> {
    let start = std::time::Instant::now();

    // ç›´æ¥è°ƒç”¨ Rust æ ¸å¿ƒåº“ï¼Œé›¶ IPC å¼€é”€ï¼
    let result = epub::reformat::reformat(&file_path, &output_path)
        .map_err(|e| e.to_string())?;

    // é€šè¿‡ Tauri äº‹ä»¶ç³»ç»Ÿå‘å‰ç«¯å‘é€è¿›åº¦
    let _ = app.emit("epub-progress", &result);

    Ok(ProcessResult {
        success: true,
        message: format!("æ ¼å¼åŒ–æˆåŠŸï¼š{} ä¸ªæ–‡ä»¶å·²é‡ç»„", result.files_moved),
        output_path: Some(output_path),
        elapsed_ms: start.elapsed().as_millis() as u64,
    })
}

/// WebP å›¾ç‰‡è½¬æ¢
#[tauri::command]
pub async fn convert_webp(
    file_path: String,
    output_path: String,
) -> Result<ProcessResult, String> {
    let start = std::time::Instant::now();

    let result = image::webp_converter::convert(&file_path, &output_path)
        .map_err(|e| e.to_string())?;

    Ok(ProcessResult {
        success: true,
        message: format!("è½¬æ¢ {} å¼ å›¾ç‰‡", result.converted),
        output_path: Some(output_path),
        elapsed_ms: start.elapsed().as_millis() as u64,
    })
}

/// TXT è½¬ EPUB
#[tauri::command]
pub async fn txt_to_epub(
    file_path: String,
    output_path: String,
) -> Result<ProcessResult, String> {
    let start = std::time::Instant::now();

    let result = txt::convert(&file_path, &output_path)
        .map_err(|e| e.to_string())?;

    Ok(ProcessResult {
        success: true,
        message: format!("ç”Ÿæˆ EPUBï¼š{} ç« ", result.chapters),
        output_path: Some(output_path),
        elapsed_ms: start.elapsed().as_millis() as u64,
    })
}
```

### 9.2 å‰ç«¯ Tauri Bridge

```typescript
// packages/gui/src/lib/tauri-bridge.ts
import { invoke } from '@tauri-apps/api/core';

export interface ProcessResult {
  success: boolean;
  message: string;
  output_path?: string;
  elapsed_ms: number;
}

export async function reformatEpub(filePath: string, outputPath: string): Promise<ProcessResult> {
  return invoke('reformat_epub', { filePath, outputPath });
}

export async function convertWebp(filePath: string, outputPath: string): Promise<ProcessResult> {
  return invoke('convert_webp', { filePath, outputPath });
}

export async function txtToEpub(filePath: string, outputPath: string): Promise<ProcessResult> {
  return invoke('txt_to_epub', { filePath, outputPath });
}
```

### 9.3 å¯¹æ¯” v2 sidecar æ–¹æ¡ˆ

```text
v2 è°ƒç”¨æµç¨‹ï¼ˆå¤æ‚ï¼‰ï¼š
  React â†’ Tauri IPC â†’ Rust â†’ spawn Node.js SEA â†’ Node.js æ‰§è¡Œ â†’ stdout â†’ Rust è§£æ â†’ IPC â†’ React
  å»¶è¿Ÿ: ~200-500msï¼Œéœ€ç®¡ç†å­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

v3 è°ƒç”¨æµç¨‹ï¼ˆç®€æ´ï¼‰ï¼š
  React â†’ Tauri IPC â†’ Rust ç›´æ¥æ‰§è¡Œ epub-core â†’ IPC â†’ React
  å»¶è¿Ÿ: ~1-5msï¼Œé›¶é¢å¤–å¼€é”€
```

---

## åã€è¿ç§»ç­–ç•¥ï¼šä» v2 (TS) åˆ° v3 (Rust)

### 10.1 è¿ç§»åŸåˆ™

1. **æ¸è¿›å¼è¿ç§»** â€” ä¸éœ€è¦ä¸€æ¬¡æ€§é‡å†™æ‰€æœ‰æ¨¡å—
2. **åŠŸèƒ½å¯¹ç­‰** â€” æ¯è¿ç§»ä¸€ä¸ªæ¨¡å—ï¼Œç¡®ä¿åŠŸèƒ½å’Œæµ‹è¯•å®Œå…¨å¯¹ç­‰
3. **v2 TS ä»£ç ä½œä¸ºå‚è€ƒ** â€” å·²å®ç°çš„ TS é€»è¾‘æ˜¯ Rust é‡å†™çš„æœ€ä½³è§„æ ¼è¯´æ˜
4. **å‰ç«¯ä¸å˜** â€” React å‰ç«¯ä»£ç å®Œå…¨å¤ç”¨ï¼Œåªæ”¹ bridge è°ƒç”¨æ–¹å¼

### 10.2 è¿ç§»é¡ºåº

```text
Phase 0: Rust Workspace éª¨æ¶
  â””â”€ Cargo workspace + epub-core crate + epub-cli crate

Phase 1: æ ¸å¿ƒåŸºç¡€ï¼ˆçº¯ç®—æ³•ï¼Œæ— å¤–éƒ¨ä¾èµ–ï¼‰
  â”œâ”€ crypto/encrypt.rs    â† ä» TS encrypt.ts ç§»æ¤
  â”œâ”€ crypto/decrypt.rs    â† ä» TS decrypt.ts ç§»æ¤
  â””â”€ epub/parser.rs       â† ä» TS parser.ts ç§»æ¤

Phase 2: EPUB å¤„ç†
  â”œâ”€ epub/writer.rs       â† ä» TS writer.ts ç§»æ¤
  â”œâ”€ epub/reformat.rs     â† ä» TS reformat.ts ç§»æ¤
  â””â”€ epub/upgrade.rs      â† ä» TS upgrade.ts ç§»æ¤

Phase 3: å›¾ç‰‡å¤„ç†
  â”œâ”€ image/webp_converter.rs  â† image crate æ›¿ä»£ sharp
  â””â”€ image/compressor.rs      â† image crate å‹ç¼©

Phase 4: å­—ä½“å¤„ç†
  â”œâ”€ font/subsetter.rs    â† allsorts æ›¿ä»£ subset-font
  â””â”€ font/obfuscator.rs   â† Python æ¡¥æ¥ (è°ƒç”¨ encrypt_font.py)

Phase 5: æ–°åŠŸèƒ½
  â”œâ”€ txt/                 â† TXTâ†’EPUB
  â”œâ”€ chinese/             â† ç®€ç¹è½¬æ¢
  â””â”€ edit/                â† ç¼–è¾‘å·¥ä½œæµ (git2)

Phase 6: GUI é›†æˆ
  â”œâ”€ Tauri commands.rs    â† ç›´æ¥è°ƒç”¨ epub-core
  â””â”€ ç§»åŠ¨ç«¯åº”ç”¨            â† Tauri mobile
```

### 10.3 v2 TS ä»£ç çš„å¤„ç½®

| v2 ç»„ä»¶ | è¿ç§»åå¤„ç½® | è¯´æ˜ |
|---------|-----------|------|
| `packages/core/` | **å½’æ¡£ååˆ é™¤** | Rust æ ¸å¿ƒå®Œå…¨æ›¿ä»£ |
| `packages/cli/` | **åˆ é™¤** | Rust CLI æ›¿ä»£ |
| `packages/gui/src/` | **ä¿ç•™** | React å‰ç«¯å®Œå…¨å¤ç”¨ |
| `packages/gui/src-tauri/` | **é‡å†™** | ç›´æ¥è°ƒç”¨ epub-core |
| `py-scripts/` | **ä¿ç•™** | å­—ä½“æ··æ·†ï¼ˆæ¡Œé¢/CLI ä¸“å±ï¼Œé€šè¿‡è¿›ç¨‹è°ƒç”¨ï¼‰ |
| `tests/` | **è¿ç§»åˆ° Rust** | `cargo test` |
| `skills/ts/` | **è¿ç§»åˆ° `skills/rs/`** | Rust é‡å†™ |

---

## åä¸€ã€å®æ–½è®¡åˆ’ (v3)

### Sprint 0ï¼šRust Workspace éª¨æ¶ï¼ˆ1 å¤©ï¼‰ âœ… å·²å®Œæˆ

- [x] åˆå§‹åŒ– Cargo workspaceï¼ˆæ ¹ `Cargo.toml`ï¼‰
- [x] åˆ›å»º `crates/epub-core/` lib crate
- [x] åˆ›å»º `crates/epub-cli/` bin crate
- [x] é…ç½® `rust-toolchain.toml`ï¼ˆRust stableï¼‰
- [x] æ›´æ–° `.mise.toml` æ·»åŠ  Rust ç‰ˆæœ¬
- [ ] åŸºæœ¬ CIï¼š`cargo check` + `cargo test`

### Sprint 1ï¼šæ ¸å¿ƒåŸºç¡€æ¨¡å—ï¼ˆ3 å¤©ï¼‰ ğŸ”„ è¿›è¡Œä¸­

- [x] `epub-core/src/epub/parser.rs` â€” ZIP + quick-xml EPUB è§£æ
- [x] `epub-core/src/epub/writer.rs` â€” EPUB æ‰“åŒ…ï¼ˆmimetype STOREï¼‰
- [x] `epub-core/src/crypto/encrypt.rs` â€” MD5 æ–‡ä»¶ååŠ å¯† + è·¯å¾„é‡å†™
- [x] `epub-core/src/crypto/decrypt.rs` â€” æ–‡ä»¶åè§£å¯†
- [x] `epub-cli` â€” clap éª¨æ¶ + `doctor`/`encrypt`/`decrypt`/`reformat` å‘½ä»¤
- [x] å•å…ƒæµ‹è¯•ï¼š24 tests passingï¼ˆåŠ å¯†ç¡®å®šæ€§ã€EPUB è§£æã€è·¯å¾„è§£æã€åˆ†ç±»ã€é‡å†™ï¼‰
- [ ] å®Œæ•´çš„åŠ å¯†/è§£å¯† pipelineï¼ˆè¯»å–â†’é‡å†™â†’æ‰“åŒ… EPUBï¼‰

### Sprint 2ï¼šEPUB å¤„ç† + å›¾ç‰‡ï¼ˆ3-4 å¤©ï¼‰

- [ ] `epub/reformat.rs` â€” Sigil æ ‡å‡†ç›®å½•é‡ç»„
- [ ] `epub/upgrade.rs` â€” EPUB2â†’3 å‡çº§
- [ ] `image/webp_converter.rs` â€” WebP â†” JPG/PNG (image crate)
- [ ] `image/compressor.rs` â€” å›¾ç‰‡å‹ç¼© (fast/balanced/max)
- [ ] CLI å‘½ä»¤å¯¹æ¥
- [ ] å¯¹æ¯”æµ‹è¯•ï¼šRust è¾“å‡º vs TS è¾“å‡ºä¸€è‡´æ€§

### Sprint 3ï¼šå­—ä½“å¤„ç†ï¼ˆ3 å¤©ï¼‰

- [ ] `font/subsetter.rs` â€” allsorts å­—ä½“å­é›†åŒ–
- [ ] `font/obfuscator.rs` â€” Python æ¡¥æ¥ï¼ˆé€šè¿‡ `std::process::Command` è°ƒç”¨ `encrypt_font.py`ï¼‰
- [ ] CLI å‘½ä»¤ï¼š`subset-fonts`, `obfuscate-font`

### Sprint 4ï¼šæ–°åŠŸèƒ½æ¨¡å—ï¼ˆ3-4 å¤©ï¼‰

- [ ] `txt/parser.rs` + `chapter_splitter.rs` + `epub_creator.rs`
- [ ] `chinese/converter.rs` â€” ç®€ç¹è½¬æ¢
- [ ] `image/download_remote.rs` â€” reqwest ä¸‹è½½è¿œç¨‹å›¾ç‰‡
- [ ] CLI å‘½ä»¤å¯¹æ¥

### Sprint 5ï¼šç¼–è¾‘å·¥ä½œæµ + Skillsï¼ˆ2 å¤©ï¼‰

- [ ] `edit/workspace.rs` â€” git2 é›†æˆ
- [ ] `edit/watcher.rs` â€” notify æ–‡ä»¶ç›‘å¬
- [ ] `edit/packer.rs` â€” æ‰“åŒ…
- [ ] Skills: `epub-info`, `charset-scan`, `merge-epub`, `split-epub`

### Sprint 6ï¼šTauri æ¡Œé¢ GUI é›†æˆï¼ˆ3 å¤©ï¼‰

- [ ] é‡å†™ `commands.rs` â€” ç›´æ¥è°ƒç”¨ epub-core
- [ ] æ›´æ–° `tauri-bridge.ts` â€” å‰ç«¯é€‚é…
- [ ] è¿›åº¦äº‹ä»¶ç³»ç»Ÿ (Tauri events)
- [ ] æ·±è‰²/æµ…è‰²ä¸»é¢˜

### Sprint 7ï¼šTauri ç§»åŠ¨ç«¯ï¼ˆ4-5 å¤©ï¼‰

- [ ] `packages/mobile/` â€” Tauri mobile é¡¹ç›®åˆå§‹åŒ–
- [ ] iOS é€‚é…ï¼š`tauri ios init` + WKWebView
- [ ] Android é€‚é…ï¼š`tauri android init` + WebView
- [ ] ç§»åŠ¨ç«¯ UIï¼ˆç²¾ç®€ç‰ˆ React ç»„ä»¶ï¼‰
- [ ] åŠŸèƒ½å­é›†ï¼šæ ¼å¼åŒ–ã€åŠ è§£å¯†ã€å›¾ç‰‡è½¬æ¢ã€ç®€ç¹ã€TXTâ†’EPUB
- [ ] æ–‡ä»¶åˆ†äº«é›†æˆï¼ˆiOS Share Sheet / Android Intentï¼‰

### Sprint 8ï¼šæµ‹è¯• + CI/CD + å‘å¸ƒï¼ˆ2-3 å¤©ï¼‰

- [ ] `proptest` å±æ€§æµ‹è¯•
- [ ] `criterion` æ€§èƒ½åŸºå‡†
- [ ] GitHub Actionsï¼šRust ä¸‰å¹³å°æ„å»º + Tauri æ¡Œé¢æ„å»º + Tauri ç§»åŠ¨æ„å»º
- [ ] `cargo publish` epub-core + epub-cli
- [ ] README æ›´æ–°ï¼ˆå®‰è£…/ä½¿ç”¨æ–‡æ¡£ï¼‰

---

## åäºŒã€ä¾èµ–ç¯å¢ƒè¦æ±‚ (v3)

### å¼€å‘ç¯å¢ƒ

```text
å¿…é¡»ï¼šRust stable (rustup)
å‰ç«¯ï¼šNode.js 22+, pnpm 10+ (ä»… GUI å‰ç«¯éœ€è¦)
ç§»åŠ¨ï¼šXcode (iOS), Android SDK + NDK (Android)
æ¨èï¼šjpegoptim, oxipng (å›¾ç‰‡æé™å‹ç¼©)
å¯é€‰ï¼šPython 3.9+ (å­—ä½“æ··æ·†åå¤‡)
```

### æœ€ç»ˆç”¨æˆ·

```text
CLIï¼š
  æ— éœ€å®‰è£…ä»»ä½•è¿è¡Œæ—¶ â€” ä¸‹è½½å•äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ä½¿ç”¨ (~5-10MB)

æ¡Œé¢ App (Tauri)ï¼š
  æ— éœ€å®‰è£…ä»»ä½•è¿è¡Œæ—¶ â€” åŒå‡»å³ç”¨ (~5-8MB)
  å­—ä½“æ··æ·†(åå¤‡)ï¼šéœ€ç³»ç»Ÿ Python 3.9+
  å›¾ç‰‡æé™å‹ç¼©ï¼šéœ€ jpegoptim / oxipngï¼ˆåº”ç”¨å†…æä¾›å®‰è£…å¼•å¯¼ï¼‰

ç§»åŠ¨ Appï¼š
  æ— éœ€é¢å¤–ä¾èµ– â€” ä» App Store / Google Play å®‰è£…å³å¯
```

---

## åä¸‰ã€æ€§èƒ½é¢„æœŸå¯¹æ¯”

| æ“ä½œ | v2 (TS/Node.js) | v3 (Rust) | é¢„æœŸæå‡ |
|------|-----------------|-----------|---------|
| CLI å¯åŠ¨æ—¶é—´ | ~200ms | ~1ms | **200x** |
| EPUB è§£æ (10MB) | ~150ms | ~20ms | **7x** |
| æ–‡ä»¶ååŠ å¯† (100æ–‡ä»¶) | ~50ms | ~5ms | **10x** |
| WebPâ†’JPG è½¬æ¢ (50å¼ ) | ~2s (sharp) | ~1.5s (image) | **1.3x** |
| å›¾ç‰‡å‹ç¼© (50å¼ ) | ~3s (sharp) | ~2s (image) | **1.5x** |
| å­—ä½“å­é›†åŒ– | ~500ms (JS) | ~100ms (allsorts) | **5x** |
| å†…å­˜å ç”¨ | ~80-150MB | ~10-30MB | **5x** |
| æ‰“åŒ…ä½“ç§¯ (CLI) | ~50MB (Node SEA) | ~5-10MB | **5-10x** |
| æ‰“åŒ…ä½“ç§¯ (GUI) | ~55MB (Tauri+SEA) | ~5-8MB | **7-10x** |

> æ³¨ï¼šå›¾ç‰‡å¤„ç†æå‡è¾ƒå°ï¼Œå›  sharp åº•å±‚ä½¿ç”¨ C åŸç”Ÿ libvipsï¼›Rust `image` crate æ˜¯çº¯ Rust å®ç°ï¼Œ
> åœ¨æŸäº›ç¼–è§£ç æ“ä½œä¸Šå¯èƒ½æ¥è¿‘ä½†ä¸ä¸€å®šè¶…è¶Š libvipsã€‚å…¶ä»–çº¯é€»è¾‘æ“ä½œæå‡æ˜¾è‘—ã€‚

---

## åå››ã€é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£ç­–ç•¥ |
|------|------|---------|
| Rust å­¦ä¹ æ›²çº¿é™¡å³­ | ä¸­ | æ¸è¿›å¼è¿ç§»ï¼Œv2 TS ä»£ç ä½œä¸ºå‚è€ƒè§„æ ¼ |
| Tauri ç§»åŠ¨ç«¯ä¸æˆç†Ÿ | ä½ | Tauri 2.x å·²ç¨³å®šï¼Œç¤¾åŒºæ´»è·ƒ |
| `image` crate æ€§èƒ½ä¸å¦‚ sharp | ä½ | å¤§å¤šæ•°åœºæ™¯è¶³å¤Ÿï¼Œæç«¯åœºæ™¯å¯ç”¨å¤–éƒ¨å·¥å…· |
| è¿ç§»æœŸé—´ç»´æŠ¤ä¸¤å¥—ä»£ç  | ä¸­ | Phase å¼è¿ç§»ï¼Œæ¯ Phase æ›¿æ¢ä¸€ä¸ªæ¨¡å—ååˆ é™¤æ—§ä»£ç  |
| opencc-rust ç»´æŠ¤çŠ¶æ€ | ä½ | å¯å†…åµŒ OpenCC è¯å…¸ + è‡ªå®šä¹‰è½¬æ¢é€»è¾‘ |

---

## åäº”ã€æ€»ç»“

### v3 æ ¸å¿ƒå˜æ›´

| ç»´åº¦ | v2 æ–¹æ¡ˆ | v3 æ–¹æ¡ˆ |
|------|--------|--------|
| **æ ¸å¿ƒè¯­è¨€** | TypeScript | **Rust** |
| **è¿è¡Œæ—¶ä¾èµ–** | Node.js 22+ | **æ— **ï¼ˆçº¯åŸç”ŸäºŒè¿›åˆ¶ï¼‰ |
| **Tauri é›†æˆ** | sidecar (è¿›ç¨‹è°ƒç”¨) | **ç›´æ¥è°ƒç”¨**ï¼ˆé›¶å¼€é”€ï¼‰ |
| **ç§»åŠ¨ç«¯** | âŒ ä¸å¯è¡Œ | âœ… **Tauri 2.x åŸç”Ÿæ”¯æŒ** |
| **CLI ä½“ç§¯** | ~50MB (Node SEA) | **~5-10MB** |
| **GUI ä½“ç§¯** | ~55MB | **~5-8MB** |
| **Python ä¾èµ–** | å­—ä½“æ··æ·†å¿…éœ€ | **å­—ä½“æ··æ·†å¿…éœ€**ï¼ˆæ¡Œé¢/CLI ä¸“å±ï¼‰ |
| **å‰ç«¯** | React + shadcn/ui | **ä¸å˜** |

### æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **ç»Ÿä¸€æ¶æ„** â€” Rust æ ¸å¿ƒä¸€æ¬¡ç¼–å†™ï¼Œæ¡Œé¢/CLI/ç§»åŠ¨ç«¯ä¸‰ç«¯å…±ç”¨
2. âœ… **ç§»åŠ¨ç«¯æ”¯æŒ** â€” Tauri 2.x åŸç”Ÿ iOS/Androidï¼Œç”¨æˆ·å¯åœ¨æ‰‹æœºä¸Šå¤„ç† EPUB
3. âœ… **æè‡´è½»é‡** â€” CLI å•æ–‡ä»¶ 5-10MBï¼ŒGUI 5-8MBï¼Œæ— å¤–éƒ¨ä¾èµ–
4. âœ… **æè‡´æ€§èƒ½** â€” å¯åŠ¨ 1msï¼Œå¤„ç†é€Ÿåº¦æ™®éæå‡ 5-10x
5. âœ… **ç®€åŒ–åˆ†å‘** â€” `cargo install epub-tools` æˆ–ä¸‹è½½äºŒè¿›åˆ¶å³å¯
6. âœ… **æ¶ˆé™¤ Node.js ä¾èµ–** â€” æœ€ç»ˆç”¨æˆ·æ— éœ€å®‰è£…ä»»ä½•è¿è¡Œæ—¶

### ä¿æŒä¸å˜

- âœ… React + TailwindCSS + shadcn/ui å‰ç«¯ï¼ˆèµ„äº§å¤ç”¨ï¼‰
- âœ… Tauri 2.x æ¡†æ¶é€‰æ‹©
- âœ… åŠŸèƒ½åˆ—è¡¨ï¼ˆæ ¼å¼åŒ–ã€åŠ è§£å¯†ã€å›¾ç‰‡ã€å­—ä½“ã€ç¼–è¾‘å·¥ä½œæµç­‰ï¼‰
- âœ… Skills å¯å¤ç”¨è„šæœ¬ä½“ç³»
- âœ… Git é›†æˆç¼–è¾‘å·¥ä½œæµï¼ˆåˆ›æ–°åŠŸèƒ½ï¼‰

---

**ç»“è®º**ï¼šv3 æ–¹æ¡ˆé€šè¿‡å°†æ ¸å¿ƒä» TypeScript è¿ç§»åˆ° Rustï¼Œè§£å†³äº† v2 æ–¹æ¡ˆçš„æ¶æ„çŸ›ç›¾ï¼ˆåŒè¿è¡Œæ—¶ã€sidecar å¤æ‚åº¦ã€ç§»åŠ¨ç«¯ä¸å¯è¡Œï¼‰ï¼Œåœ¨ä¿æŒæ‰€æœ‰åŠŸèƒ½å’Œ React å‰ç«¯ä¸å˜çš„å‰æä¸‹ï¼Œå®ç°äº†çœŸæ­£çš„è·¨å¹³å°ç»Ÿä¸€â€”â€”æ¡Œé¢ã€å‘½ä»¤è¡Œã€ç§»åŠ¨ç«¯å…±ç”¨åŒä¸€ä¸ª Rust æ ¸å¿ƒå¼•æ“ã€‚
